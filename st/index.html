<html>
<head>
  <title>Search form</title>
  <script type="text/javascript" src="/search?name=jquery-1.3.2.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $("#text").keyup(function () {
        var v = $("#text").val();
        setTimeout(function() {query_changed(v)}, 400);
      });
    });

    function query_changed(oldVal) {
      var text = $("#text").val();
      if (text != oldVal) {
        return;
      }
      $.getJSON("/search", {'output': 'json',
                            'q': text,
                            'n': 20,
                           },
                function(json) {
                  $("#res").html('');
                  $("#res").append("<div>" + json['q'] + "</div>");
                  for (var i = 0; i < json['data'].length; ++i) {
                    var t = json['data'][i]
                    $("#res").append("<div>" + t['title'] + "</div>");
                  }
                });
    }
  </script>
  <style>
    #res {
      background-color: #ddd;
    }
  </style>
</head>
<body>
  <form action="javascript:;">
    <input type="text" id="text" size="40">
  </form>
  <div id="res"></div>
</body>
</html>
